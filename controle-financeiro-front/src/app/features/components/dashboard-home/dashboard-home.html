<div class="dashboard-home">
  <div class="header">
    <h2>Dashboard</h2>
    <div class="header-actions">
      <button
        class="btn-compare"
        (click)="compararMesPassado()"
        [disabled]="comparando"
      >
        {{
          comparando
            ? "Comparando…"
            : comparativo
            ? "Fechar comparação"
            : "Comparar mês passado"
        }}
      </button>
      <div class="export-menu" [class.open]="showExportMenu">
        <button class="btn-download" (click)="toggleExportMenu($event)">
          Exportar relatório
        </button>
        <div class="menu" *ngIf="showExportMenu">
          <button class="menu-item" (click)="exportarExcel()">
            Exportar Excel
          </button>
          <button class="menu-item" (click)="exportarPdf()">
            Exportar PDF
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="content">
    <div class="stats-header">
      <div class="title">
        <span class="kicker">Resumo de</span>
        <h3>{{ periodoLabel }}</h3>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-card receita">
        <div class="stat-title">Total de Receitas</div>
        <div class="stat-value">
          {{ totalReceitas | currency : "BRL" : "symbol" : "1.2-2" }}
        </div>
      </div>
      <div class="stat-card despesa">
        <div class="stat-title">Total de Despesas</div>
        <div class="stat-value">
          {{ totalDespesas | currency : "BRL" : "symbol" : "1.2-2" }}
        </div>
      </div>
      <div
        class="stat-card saldo"
        [ngClass]="{
          positivo: saldo > 0,
          negativo: saldo < 0,
          neutro: saldo === 0
        }"
      >
        <div class="stat-title">Saldo Final</div>
        <div class="stat-value">
          {{ saldo | currency : "BRL" : "symbol" : "1.2-2" }}
        </div>
      </div>
    </div>
    <div class="comparativo" *ngIf="comparativo">
      <div class="comparativo-header">
        <div class="title">Mês passado (até dia {{ comparativoDia }})</div>
        <button class="link-clear" type="button" (click)="limparComparativo()">
          Limpar
        </button>
      </div>
      <div class="comparativo-grid">
        <div class="comp-card">
          <div class="label">Receitas</div>
          <div class="value">
            {{
              comparativo.totalReceitas | currency : "BRL" : "symbol" : "1.2-2"
            }}
          </div>
          <div class="delta" [ngClass]="classeDelta(receitasDelta)">
            {{ formatarDelta(receitasDelta) }}
          </div>
        </div>
        <div class="comp-card">
          <div class="label">Despesas</div>
          <div class="value">
            {{
              comparativo.totalDespesas | currency : "BRL" : "symbol" : "1.2-2"
            }}
          </div>
          <div class="delta" [ngClass]="classeDelta(despesasDelta)">
            {{ formatarDelta(despesasDelta) }}
          </div>
        </div>
        <div class="comp-card">
          <div class="label">Saldo</div>
          <div class="value">
            {{ comparativo.saldo | currency : "BRL" : "symbol" : "1.2-2" }}
          </div>
          <div class="delta" [ngClass]="classeDelta(saldoDelta)">
            {{ formatarDelta(saldoDelta) }}
          </div>
        </div>
      </div>
    </div>
    <div class="charts">
      <div class="chart-card">
        <h3>Receitas do Mês</h3>
        <canvas
          baseChart
          [data]="receitasChartData"
          [type]="'pie'"
          [options]="pieChartOptions"
        ></canvas>
        <div class="chart-summary">
          <div
            class="summary-row"
            *ngFor="let item of receitasResumo; let i = index"
          >
            <span
              class="dot"
              [style.backgroundColor]="corReceita(item.label)"
            ></span>
            <span class="label">{{ item.label }}</span>
            <span class="value">{{
              item.valor | currency : "BRL" : "symbol" : "1.2-2"
            }}</span>
          </div>
        </div>
      </div>
      <div class="chart-card">
        <h3>Despesas do Mês</h3>
        <canvas
          baseChart
          [data]="despesasChartData"
          [type]="'pie'"
          [options]="pieChartOptions"
        ></canvas>
        <div class="chart-summary">
          <div
            class="summary-row"
            *ngFor="let item of despesasResumo; let i = index"
          >
            <span
              class="dot"
              [style.backgroundColor]="corDespesa(item.label)"
            ></span>
            <span class="label">{{ item.label }}</span>
            <span class="value">{{
              item.valor | currency : "BRL" : "symbol" : "1.2-2"
            }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
